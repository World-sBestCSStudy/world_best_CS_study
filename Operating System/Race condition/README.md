# 경쟁 상태

레이스 컨디션은 두 개 이상의 프로세스나 스레드가 동시에 같은 자원에 접근하고 이를 조작하려 할 때 발생하는 문제입니다. 이로 인해 데이터의 일관성이 깨지거나 예상치 못한 결과가 발생할 수 있습니다

**커널 모드**? 커널 모드는 운영 체제의 핵심 부분인 커널이 실행되는 특권 모드입니다. 이 모드에서는 CPU가 모든 명령을 실행할 수 있으며, 하드웨어와 메모리에 직접 접근할 수 있습니다.4

운영 체제는 일반적으로 두 가지 모드, 즉 커널 모드와 사용자 모드(User Mode)로 나누어집니다.

## 1. 커널 작업을 수행하는 중에 인터럽트 발생

### 문제점:

- **상황**: 커널 모드에서 특정 데이터를 로드하여 작업을 수행하고 있는 도중에 인터럽트가 발생할 수 있습니다.
- **문제**: 인터럽트 서비스 루틴(ISR)이 동일한 데이터를 조작하려 할 때, 커널 모드에서 작업 중이던 데이터와 충돌이 발생할 수 있습니다. 이는 데이터 일관성 문제를 야기할 수 있습니다.

### 해결법:

- **인터럽트 비활성화**: 커널 모드에서 작업을 수행하는 동안 인터럽트를 비활성화(disable)하여 CPU 제어권을 인터럽트가 가져가지 못하도록 합니다.

### 2. 프로세스가 'System Call'을 하여 커널 모드로 진입하여 작업을 수행하는 도중 문맥 교환이 발생할 때

### 문제점:

- **상황**: 프로세스1이 커널 모드에서 시스템 호출(System Call)을 통해 데이터를 조작하는 도중에 타임 슬라이스가 끝나고 문맥 교환(Context Switching)이 발생할 수 있습니다.
- **문제**: 문맥 교환으로 인해 CPU 제어권이 프로세스2로 넘어가고, 프로세스2가 동일한 데이터를 조작하려 할 때, 프로세스1의 작업이 반영되지 않은 상태로 데이터가 조작될 수 있습니다.

### 해결법:

- **커널 모드 보호**: 프로세스가 커널 모드에서 작업을 하는 경우, 문맥 교환이 발생하지 않도록 합니다. 즉, 커널 모드에서 작업이 끝날 때까지 타임 슬라이스가 초과되더라도 다른 프로세스로 제어권이 넘어가지 않도록 합니다.

### 3. 멀티 프로세서 환경에서 공유 메모리 내의 커널 데이터에 접근할 때

### 문제점:

- **상황**: 멀티 프로세서 환경에서는 여러 CPU가 동시에 커널 내부의 공유 데이터에 접근하여 조작할 수 있습니다.
- **문제**: 두 개 이상의 CPU가 동시에 동일한 데이터를 조작하면, 데이터의 일관성이 깨지거나 예상치 못한 결과가 발생할 수 있습니다.

### 해결법:

- **락 메커니즘**: 커널 내부에 있는 각 공유 데이터에 접근할 때마다, 그 데이터에 대한 lock/unlock을 사용하여 동시 접근을 제어합니다. 이를 통해 하나의 CPU만이 데이터를 조작할 수 있도록 합니다.

커널 모드가 아니여도 데이터 일관성 문제가 생길 수 있는 것 아닌가??

### 커널 모드와 사용자 모드의 차이

- **커널 모드 (Kernel Mode)**: 운영 체제 커널이 실행되는 모드로, 시스템 자원과 하드웨어에 대한 완전한 접근 권한을 갖습니다. 커널 모드에서는 메모리 관리, 프로세스 관리, 파일 시스템, 네트워크 등의 핵심 기능을 수행합니다.
- **사용자 모드 (User Mode)**: 일반 애플리케이션이 실행되는 모드로, 제한된 자원에만 접근할 수 있습니다. 사용자 모드에서 실행되는 프로그램은 시스템 자원에 접근하기 위해 커널 모드로 전환하는 시스템 호출을 사용합니다.

### 왜 커널 모드가 강조되는가?

- **권한과 안전성**: 커널 모드는 시스템의 핵심 기능을 담당하므로, 작은 오류라도 시스템 전체에 큰 영향을 미칠 수 있습니다. 따라서 커널 모드에서의 데이터 보호는 매우 중요합니다.
- **시스템 자원 관리**: 커널 모드에서는 시스템 자원(메모리, CPU 등)을 직접 관리하므로, 레이스 컨디션이 발생하면 시스템 전체의 안정성이 위협받을 수 있습니다.

커널 모드에서는 사용자 모드와는 다른 방법으로 동기화 문제를 해결해야 할 필요성이 있으며, 이것이 커널 모드가 별도로 언급되는 이유

### 사용자 모드에서의 레이스 컨디션 해결

- **문제**: 사용자 모드에서도 여러 스레드나 프로세스가 공유 데이터에 동시 접근하면 데이터 일관성이 깨질 수 있습니다.
- **해결법**: 뮤텍스(Mutex), 세마포어(Semaphore), 원자적 연산(Atomic Operations) 등을 사용하여 동기화 문제를 해결합니다. 이러한 메커니즘을 사용하면 사용자 모드에서도 안전하게 공유 데이터를 조작할 수 있습니다.
